<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:jsp="http://java.sun.com/JSP/Page"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:rich="http://richfaces.org/rich">

<f:view contentType="text/html" locale="#{loginMB.locale}">
<head>
<meta http-equiv="expires" content="0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Pragma" content="no-cache" />
<!-- Mimic Internet Explorer 8 -->
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" />

<title><ui:insert name="title">#{global.application_title}</ui:insert></title>
<link rel="stylesheet"
	href="#{facesContext.externalContext.requestContextPath}/layout/css/basic.css"
	type="text/css" />

<link rel="stylesheet"
	href="#{facesContext.externalContext.requestContextPath}/layout/css/office.css"
	type="text/css" />


<link rel="stylesheet"
	href="#{facesContext.externalContext.requestContextPath}/layout/css/custom.css"
	type="text/css" />


<!-- Redirection when user clicks on browser history back.... -->
<script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/layout/js/rsh/rsh.js"></script>
<script type="text/javascript">
// see http://code.google.com/p/reallysimplehistory/
window.dhtmlHistory.create({
        toJSON: function(o) {
                return Object.toJSON(o);
        }
        , fromJSON: function(s) {
                return s.evalJSON();
        }
});
var workitemBackListener = function(newLocation, historyData) {
        //do something;
    var idurl="#{facesContext.externalContext.requestContextPath}/index.jsf?workitem=#{workitemMB.workitem.item['$Uniqueid']}";
	//alert(idurl);
	document.location.href=idurl;
}
window.onload = function() {
        dhtmlHistory.initialize();
        dhtmlHistory.addListener(workitemBackListener);
};
</script>
</head>


<body>


	<f:loadBundle basename="bundle.global" var="global" />

	<div id="sywapp-servicenav"><ui:insert name="servicenav">
		<ui:include src="servicenav.xhtml" />
	</ui:insert></div>

	<div id="sywapp-topnav"><ui:insert name="topnav">
		<ui:include src="header.xhtml" />
		
	</ui:insert></div>

	<div id="sywapp-sidebar">
	   
		<ui:insert name="commandbox">
			<ui:include src="commandbox.xhtml" />
		</ui:insert>
	
		<ui:insert name="projectnews">
			<ui:include src="projectnotes.xhtml" />
		</ui:insert>
		
		<ui:insert name="projecttree">
			<ui:include src="projecttree.xhtml" />
		</ui:insert>
	
		<c:if test="#{IsUserInRole['org.imixs.ACCESSLEVEL.MANAGERACCESS']}">
		<ui:insert name="adminbox" >
				<ui:include src="commandbox_admin.xhtml" />
		</ui:insert>
		</c:if>
	</div>

	<div id="sywapp-historynav">
		<ui:insert name="historynav">
			<ui:include src="historynav.xhtml" />
		</ui:insert>
	</div>

	<div id="sywapp-content"><ui:insert name="content">
		<h2>Default Content</h2>
	</ui:insert></div>

	<div id="sywapp-footer"><ui:insert name="footer">
		<ui:include src="footer.xhtml" />
	</ui:insert></div>

	<c:if test="#{loginMB.authenticated}">
		<c:if test="#{! setupMB.setupOk}">
			<ui:include src="/systemsetup.xhtml" />
		</c:if>
		
		
		<c:if test="#{setupMB.setupOk and myProfileMB.workitem.item['$processid'] lt '210'}">
			<ui:include src="/verifyprofile.xhtml" />
		</c:if>

	</c:if>
	
	


</body>

</f:view>

</html>