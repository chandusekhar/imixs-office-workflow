<f:subview xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich" id="workitem_footer_id">

	<div class="sywapp-form-footer sywapp-workitem-footer">
		<!-- *** Workflow (Author) **** -->
		<rich:panel>
			<f:facet name="header">
				<h:outputText value="#{global.workflow}" />
			</f:facet>

			
			<c:choose>
				<c:when
					test="#{workitemMB.workitem.item['$isAuthor'] or workitemMB.newWorkitem}">


					<ui:repeat value="#{workitemMB.activities}" var="activity">
						<a4j:outputPanel>
							<h:commandButton action="#{workitemMB.getAction}"
								onclick="getEditorPlainText();"
								actionListener="#{workitemMB.doProcess}"
								value="#{activity.item['txtname']}">
								<f:param name="id" value="#{activity.item['numactivityid']}" />
							</h:commandButton>
							<rich:toolTip
								rendered="#{! empty activity.item['rtfdescription']}"
								style="max-width:400px;" layout="block">
								<span>#{activity.item['rtfdescription']}</span>
							</rich:toolTip>
						</a4j:outputPanel>
					</ui:repeat>

					<a4j:outputPanel
						rendered="#{IsUserInRole['org.imixs.ACCESSLEVEL.MANAGERACCESS']}">
						<!-- *** Soft Delete  *** -->
						<a4j:commandButton
							rendered="#{workitemMB.workitem.item['type'] eq 'workitem'}"
							value="#{global.delete}" id="delete_button" />
						<rich:componentControl for="delete_panel" attachTo="delete_button"
							operation="show" event="onclick" />

						<!-- *** Restore Soft Delete  *** -->
						<h:commandButton
							rendered="#{workitemMB.workitem.item['type'] eq 'workitemdeleted'}"
							action="home"
							actionListener="#{workitemMB.doRestoreFromDeletions}"
							value="#{global.restore}">
						</h:commandButton>

					</a4j:outputPanel>
				</c:when>

				<c:otherwise>
					<!-- jQuery code to disabel all input elements in read modus -->
					<script type="text/javascript">

						jQuery(".sywapp-form-body :input").attr("disabled", true);
					
					</script>
				</c:otherwise>
			</c:choose>

			<!-- *** Close  *** -->
			<h:commandButton immediate="true" action="home"
				value="#{global.close}"				
				actionListener="#{workitemHistoryMB.doRemoveWorkitem}">								
				<f:param name="id" value="#{workitemMB.workitem.item['$uniqueID']}" />
			</h:commandButton>		
		</rich:panel>





		<!--  Confirm Delete -->
		<rich:modalPanel id="delete_panel" width="390" height="150">
			<f:facet name="header">
				<h:panelGroup>
					<h:outputText value="#{global.confirm}"></h:outputText>
				</h:panelGroup>
			</f:facet>
			<f:facet name="controls">
				<h:panelGroup>
					<h:graphicImage value="/layout/icons/close.png"
						style="cursor:pointer" id="hidelink" />
					<rich:componentControl for="delete_panel" attachTo="hidelink"
						operation="hide" event="onclick" />
				</h:panelGroup>
			</f:facet>

			<h:outputText  escape="false" 
				value="#{workitemMB.workitem.item['txtWorkflowSummary']}"></h:outputText>
			<br />
			<h:outputText value="#{global.delete_help1}"></h:outputText>
			<br />
			<br />
			<a href="#" onclick="#{rich:component('delete_panel')}.hide()"> <h:outputText
					value="#{global.no}" /></a>

			<rich:spacer width="24px" />
			<h:commandLink value="#{global.yes}" action="home"  immediate="true"
				actionListener="#{workitemMB.doSoftDelete}" />
		</rich:modalPanel>


	</div>
</f:subview>
