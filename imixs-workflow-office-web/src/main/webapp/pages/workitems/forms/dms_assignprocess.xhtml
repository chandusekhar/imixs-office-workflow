<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="/layout/template.xhtml">

	<ui:define name="content">

		<f:view>
			<f:loadBundle basename="bundle.dms" var="dms_messages" />


			<h:form  id="scheduler_form_id">
				<div class="sywapp-form">

					<div class="sywapp-form-header">
						<h2>
							<h:outputText value="#{dms_messages.assign}" />
						</h2>


						<a4j:outputPanel  styleClass="sywapp-viewentry">

							<!-- *** Image *** -->
							<a4j:outputPanel layout="block"
								style="float:left;height:34px;margin-right:2px;margin-left:2px;margin-bottom:0px;">

								<h:graphicImage url="/layout/icons/icon048.png"
									style="border:0px;vertical-align: text-top;margin-right:0.5em"></h:graphicImage>
							</a4j:outputPanel>
							
							<!-- link to all documents -->
							<ui:repeat value="#{dmsMB.workitem.files}" var="attachment">
							
							
								
								<a4j:outputPanel>
									<h:outputText escape="false" value="&lt;a target='_blank'" />
									<h:outputText escape="false"
										value=" href='#{facesContext.externalContext.requestContextPath}/RestService/workflow/workitem/#{dmsMB.workitem.item['$uniqueID']}/file/#{attachment}" />
									<h:outputText escape="false"
										value="'&gt;#{dmsMB.workitem.item['txtName']}&lt;/a&gt;" />
								</a4j:outputPanel>
								<br />
							</ui:repeat>

							<h:outputText value="#{global.created}: " />
							<h:outputText value="#{dmsMB.workitem.item['$created']}">
								<f:convertDateTime timeZone="#{global.timeZone}"
									pattern="#{global.dateTimePattern}" />
							</h:outputText>

						</a4j:outputPanel>

					</div>



					<a4j:outputPanel layout="block" styleClass="sywapp-form-body">


						<rich:panel>
							<f:facet name="header">
								<h:outputText value="#{dms_messages.search_title}" />
							</f:facet>

							<dl class="columns-1">
								<dt>
									<h:outputLabel value="#{dms_messages.search_process}: " />
								</dt>
								<dd>
									<a4j:region id="suggestbox_region1">
										<!-- ##########  Box with input field for workitem search ################ -->
										<a4j:outputPanel layout="block" style="float:left;">
											<h:inputText id="suggestbox_user_input1" style="width:100px;" />

											<a4j:status for="suggestbox_region1">
												<f:facet name="start">
													<h:graphicImage value="/layout/icons/ajax-loader.gif" />
												</f:facet>
											</a4j:status>

										</a4j:outputPanel>


										<!-- ##########  Tooltip ################ -->
										<rich:toolTip for="suggestbox_user_input1" layout="block"
											followMouse="true">
											<h:outputText escape="false"
												value="#{dms_messages.search_process_help}" />
										</rich:toolTip>

										<!-- ##########  Suggestbox for process search ################ -->
										<rich:suggestionbox for="suggestbox_user_input1" minChars="3"
											fetchValue="" nothingLabel="No entry found"
											usingSuggestObjects="true" 											
											suggestionAction="#{workitemLookupMB.suggestProcess}"
											var="suggest" width="300">

											<h:column >
												<h:outputText value="#{suggest.item['$modified']}">
													<f:convertDateTime timeZone="#{global.timeZone}"
														pattern="#{global.dateTimePatternShort}" />
												</h:outputText>

												<h:outputText
													value=": #{suggest.item['txtWorkflowSummary']}"
													rendered="#{!empty suggest.item['txtWorkflowSummary']}" />
												<br />
												<h:outputText style="font-weight: bold;"
													value="#{suggest.item['txtworkflowgroup']}: " />
												<h:outputText value="#{suggest.item['txtworkflowstatus']}" />

											</h:column>

											<a4j:support event="onselect" 
												actionListener="#{dmsMB.doAssignWorkitem}"
												action="open_workitem" 
												reRender="workitem_block,#{rerender_id}">
												<f:setPropertyActionListener
													value="#{suggest.item['$uniqueid']}"
													target="#{dmsMB.workitem.item['_reference']}" />
											</a4j:support>



										</rich:suggestionbox>




									</a4j:region>

								</dd>
							</dl>

							<div style="clear: left;" />

						</rich:panel>



						<!-- #### Start a new Process -->



						<rich:panel>
							<f:facet name="header">
								<h:outputText value="#{global.start_new_process}" />
							</f:facet>


							<!-- *** Start Project List *** -->

							<ui:repeat value="#{projectlistMB.startProjects}"  
							   var="project">

								<div style="float: left; margin-left:5px; width: 200px;">

									<h3>
										<h:outputText value="#{project.item['txtName']}" />
									</h3>
									<h:outputText value="#{project.item['txtdescription']}" />

									<div class="sywapp-processlist">
										<!-- *** Process List *** -->
										<ul>
											<ui:repeat
												value="#{projectlistMB.processList[project.item['$uniqueid']]}"
												var="process">
												<li><h:commandLink action="open_workitem"
														actionListener="#{dmsMB.doAssignNewWorkitem}"
														value="#{process.item['txtworkflowgroup']} Â»">
														<f:param name="id"
															value="#{process.item['$modelversion']}|#{process.item['numprocessid']}" />
														<f:param name="project"
															value="#{project.item['$uniqueid']}" />
													</h:commandLink> <a4j:outputPanel layout="block">
														<h:outputText value="#{process.item['rtfdescription']}"
															escape="false" />
													</a4j:outputPanel></li>
											</ui:repeat>
										</ul>
									</div>
								</div>
							</ui:repeat>

							<div style="clear: left;" />


						</rich:panel>

						<h:commandButton value="#{global.close}" action="home" />

					</a4j:outputPanel>

				</div>





			</h:form>
		</f:view>
	</ui:define>



</ui:composition>
