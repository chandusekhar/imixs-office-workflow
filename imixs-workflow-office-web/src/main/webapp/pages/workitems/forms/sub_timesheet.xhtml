<f:subview xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich" id="sub_timesheet_form">


	<a4j:region>
		<!-- Timesheet - filter box -->
		<rich:panel>
			<f:facet name="header">
				<h:outputText value="#{global.filter}" />
			</f:facet>
			<dl class="columns-2">

				<!-- ### Strasse ### -->
				<dt>
					<h:outputLabel value="#{form_messages.sub_timesheet_creator}" />
				</dt>
				<dd>
					<h:inputText value="#{timeSheetMB.filter.item['namcreator']}" />
				</dd>

				<!-- ### Status ### -->
				<dt>
					<h:outputLabel value="#{global.status}" />
				</dt>
				<dd>
					<h:selectOneMenu id="process_filter"
						value="#{timeSheetMB.filter.item['$processid']}">
						<f:selectItem itemLabel="#{messages.search_all}" itemValue="0" />
						<f:selectItems value="#{timeSheetMB.processFilterSelection}" />

					</h:selectOneMenu>
				</dd>

				<!-- ### Timerange ### -->
				<dt>
					<h:outputLabel value="#{global.from}" />
				</dt>
				<dd>
					<rich:calendar value="#{timeSheetMB.filter.item['datfrom']}"></rich:calendar>
				</dd>


				<dt>
					<h:outputLabel value="#{global.to}" />
				</dt>
				<dd>
					<rich:calendar value="#{timeSheetMB.filter.item['datto']}"
						enableManualInput="true"></rich:calendar>
				</dd>

			</dl>
			<div style="clear: left;" />
			<a4j:commandButton value="#{global.search}"
				actionListener="#{timeSheetMB.doReset}"
				reRender="child_datatable_area" />


			<a4j:commandButton value="Simulate" rendered="false"
				actionListener="#{timeSheetMB.doSimulate}"
				reRender="child_datatable_area" />


		</rich:panel>






		<!--  Result -->
		<a4j:outputPanel id="child_datatable_area">


			<!-- Show Status Message.... -->
			<a4j:status
				onstart="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:350, top:400})"
				onstop="Richfaces.hideModalPanel('ajaxLoadingModalBox')"></a4j:status>


			<rich:dataTable id="child_datatable_ID" columns="8" rows="20"
				value="#{timeSheetMB.filterTimeSheet}" var="child" sortMode="multi"
				styleClass="sywapp-subform-table">

				<rich:column>
					<f:facet name="header">
						<h:outputText value="#{form_messages.sub_timesheet_date}" />
					</f:facet>
					<h:outputText value="#{child.item['datdate']}">
						<f:convertDateTime timeZone="#{global.timeZone}"
							pattern="#{global.datePattern}" />
					</h:outputText>
				</rich:column>

				<rich:column>
					<f:facet name="header">
						<h:outputText value="#{global.creator}" />
					</f:facet>
					<h:outputText value="#{child.item['namCreator']}" />
				</rich:column>



				<rich:column sortBy="#{child.item['_subject']}" sortable="true"
					sortExpression="#{child.item['_subject']}">
					<f:facet name="header">
						<h:outputText value="#{form_messages.sub_timesheet_subject}" />
					</f:facet>
					<h:outputText value="#{child.item['_subject']}" />
				</rich:column>

				<rich:column>
					<f:facet name="header">
						<h:outputText value="#{form_messages.sub_timesheet_duration}" />
					</f:facet>
					<h:outputText value="#{child.item['_duration']}">
						<f:convertNumber minFractionDigits="2" locale="#{loginMB.locale}" />
					</h:outputText>

					<f:facet name="footer">
						<h:outputText
							value="#{timeSheetMB.filterTimeSheetSummary.item['_duration']}">
							<f:convertNumber minFractionDigits="2" locale="#{loginMB.locale}" />
						</h:outputText>
					</f:facet>
				</rich:column>

				<rich:column sortable="true" sortBy="#{child.item['_category']}"
					sortExpression="#{child.item['_category']}">
					<f:facet name="header">
						<h:outputText value="#{form_messages.sub_timesheet_category}" />
					</f:facet>
					<h:outputText value="#{child.item['_category']}" />
				</rich:column>


				<rich:column sortBy="#{child.item['txtworkflowstatus']}"
					sortable="true" sortExpression="#{child.item['txtworkflowstatus']}">
					<f:facet name="header">
						<h:outputText value="Status" />
					</f:facet>
					<h:outputText value="#{child.item['txtworkflowstatus']}" />
				</rich:column>



				<rich:column>
					<f:facet name="header">
                    #{global.action}
                </f:facet>

					<!-- Edit Action -->
					<rich:toggleControl for="suggest_process_id"
						actionListener="#{timeSheetMB.doEdit}"
						reRender="time_editor_panel_id" id="edit_button_id_control"
						switchToState="time_editor_open">
						<h:commandButton image="/layout/icons/Edit_16.png"
							value="#{global.edit}" id="edit_button_id" alt="#{global.edit}" />
					</rich:toggleControl>

					<!-- Delete Action -->
					<rich:toggleControl for="suggest_process_id"
						actionListener="#{timeSheetMB.doEdit}" id="delete_button_id"
						oncomplete="#{rich:component('deletePanel')}.show()"
						reRender="deletePanel" switchToState="time_editor_closed">
						<h:commandButton image="/layout/icons/Delete_16.png"
							style="margin-left:10px;" />
						<rich:toolTip for="delete_button_id" value="#{global.delete}" />
					</rich:toggleControl>

				</rich:column>


			</rich:dataTable>
			<rich:datascroller for="child_datatable_ID" />
		</a4j:outputPanel>

		<!-- Editor  -->
		<rich:togglePanel switchType="ajax" id="suggest_process_id"
			validatorMessage="Error"
			stateOrder="time_editor_closed,time_editor_open">

			<!-- Editor Panel closed -->
			<f:facet name="time_editor_closed">
				<a4j:outputPanel>
					<rich:toggleControl for="suggest_process_id"
						switchToState="time_editor_open" reRender="time_editor_panel_id">
						<a4j:commandButton actionListener="#{timeSheetMB.doCreate}"
							reRender="time_editor_panel_id" value="#{global.add}">
							<f:param name="id"
								value="#{workitemMB.workitem.item['$modelversion']}|6100" />
						</a4j:commandButton>

					</rich:toggleControl>
				</a4j:outputPanel>
			</f:facet>


			<!-- Editor Panel open -->
			<f:facet name="time_editor_open">

				<a4j:outputPanel id="time_editor_panel_id" layout="block"
					styleClass="sywapp-subform-body">

					<div style="float: left; width: 300px;">
						<h:panelGrid columns="2">
							<h:outputText value="#{form_messages.sub_timesheet_date}: " />
							<rich:calendar value="#{workitemMB.child.item['datdate']}" />
							<h:outputText value="#{form_messages.sub_timesheet_duration}: " />
							<h:inputText id="ln"
								value="#{workitemMB.child.item['_duration']}" required="false"
								style="width:30px;">
									<f:convertNumber minFractionDigits="2" locale="de" />
							</h:inputText>
							<h:outputText value="#{form_messages.sub_timesheet_category}: " />
							<h:inputText value="#{workitemMB.child.item['_category']}"
								style="width:70px;" />
						</h:panelGrid>
					</div>
					<div style="">
						<h:panelGrid columns="1">
							<h:outputText value="#{form_messages.sub_timesheet_subject}: " />

							<h:inputTextarea value="#{workitemMB.child.item['_subject']}"
								style="height:4em;width:350px" />
						</h:panelGrid>
					</div>
					<div style="clear: left;" />
					<h:panelGrid columns="1">
						<h:panelGroup>
							<h:outputText style="font-weight:bold;"
								value="#{messages.change_history}:" />
							<ui:repeat
								value="#{workitemMB.child.itemListArray['txtworkflowhistorylog']}"
								var="log">
								<h:outputText value="#{log}" />
								<br />
							</ui:repeat>
						</h:panelGroup>
					</h:panelGrid>


					<br />

					<!-- *** Workflow Actions **** -->
					<ui:repeat value="#{workitemMB.childActivities}"
						var="activitychild">

						<rich:toggleControl for="suggest_process_id"
							switchToState="time_editor_closed">
							<a4j:commandButton actionListener="#{workitemMB.doProcessChild}"
								reRender="child_datatable_area"
								value="#{activitychild.item['txtname']}">
								<f:param name="id"
									value="#{activitychild.item['numactivityid']}" />
							</a4j:commandButton>
						</rich:toggleControl>
					</ui:repeat>


					<rich:toggleControl for="suggest_process_id"
						switchToState="time_editor_closed">
						<a4j:commandButton value="#{global.close}">

						</a4j:commandButton>

					</rich:toggleControl>

				</a4j:outputPanel>
			</f:facet>
		</rich:togglePanel>






		<!-- Delete Dialog -->
		<rich:modalPanel id="deletePanel" autosized="true" width="200">
			<f:facet name="header">
				<h:outputText value="#{form_messages.sub_timesheet_delete_help}"
					style="padding-right:15px;" />
			</f:facet>
			<f:facet name="controls">
				<h:panelGroup>
					<h:graphicImage value="/layout/icons/close.gif"
						styleClass="hidelink" id="hidelink2" />
					<rich:componentControl for="deletePanel" attachTo="hidelink2"
						operation="hide" event="onclick" />
				</h:panelGroup>
			</f:facet>
			<h:outputText value="#{workitemMB.child.item['datdate']}">
				<f:convertDateTime timeZone="#{global.timeZone}"
					pattern="#{global.datePattern}" />
			</h:outputText>
			<h:outputText value=" :  #{workitemMB.child.item['_subject']}" />
			<table style="width: 100%">
				<tbody>
					<tr>
						<td align="center" width="50%"><a4j:commandButton
								value="#{global.yes}" ajaxSingle="true"
								actionListener="#{workitemMB.doSoftDeleteChild}"
								oncomplete="#{rich:component('deletePanel')}.hide();"
								reRender="child_datatable_area" /></td>
						<td align="center" width="50%"><a4j:commandButton
								value="#{global.no}"
								onclick="#{rich:component('deletePanel')}.hide();return false;" />
						</td>
					</tr>
				</tbody>
			</table>

		</rich:modalPanel>


		<!-- Please Wait Box -->
		<rich:modalPanel id="ajaxLoadingModalBox" height="70" width="250"
			zindex="2000">
			<f:facet name="header">
				<h:outputText value="#{global.wait_help1}"></h:outputText>
			</f:facet>
			<h:outputText value="#{global.wait_help2}"></h:outputText>
		</rich:modalPanel>
	</a4j:region>
</f:subview>

