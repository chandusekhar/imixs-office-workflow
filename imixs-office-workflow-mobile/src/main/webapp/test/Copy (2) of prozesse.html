<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Prozesse</title>
</head>
<body>

	<div data-role="page" id="prozesse">

		<div data-role="header">
			<h1>Imixs Office Workflow - Projekte</h1>
			<a href="index.html" data-role="button" data-icon="back"
				data-iconpos="right">Back</a> <a href="prozesse.html"
				onclick="clearView();buildView();"
				data-role="button" data-icon="refresh" data-iconpos="right">Aktualisieren</a>
		</div>
		<!-- /header -->

		<div data-role="content">
			<ul id="projects_id" data-role="listview" data-theme="e"
				data-inset="true" data-filter="false">

			</ul>

		</div>

		<div data-role="footer">
			<h1>Version 0.0.1</h1>
		</div>
	</div>
	<script>
	
		// build the view
		buildView();
		
	
	
		// this method clears the wrokflwo groups from the local cache and 
		// removes the view body
		function clearView() {
			localStorage
			.removeItem("com.imixs.workflowgroups");
			$("#projects_id").empty();
		
		}
	
	
		// this method fills the view body with the entries
		function buildView() {

			// we first test if we still have the workflow groups in the local storrage
			//alert(" es geht los");
			//localStorage.clear();
			var vWorkflowGroups = localStorage
					.getItem("com.imixs.workflowgroups");
			if (vWorkflowGroups == null) {
				// create the list of workfow groups
				vWorkflowGroups = new Array();
				//alert('starting json request ....');
				$.getJSON("/office-mobile/rest/report/workflowgroups.json?", {
					count : "-1",
					start : "0"
				}, function(data) {

					// iterate over all workitems and store the workflowgroups into a array
					$.each(data.entity, function(i, workitem) {
						var workflowGroup = "";
						var unid = "";
						// find the item with the name of the workflowgroup 

						for ( var j = 0; j < workitem.item.length; j++) {
							//alert("item"+j);
							if (workitem.item[j].name == "txtworkflowgroup") {
								workflowGroup = workitem.item[j].value.$;
							}

						}

						// create link 

						// add the new Group name to the current list if not yes stored and the group name 
						// has no '~' character (this indicates subgoups) 
						if ($.inArray(workflowGroup, vWorkflowGroups) == -1
								&& workflowGroup.indexOf('~') == -1)
							vWorkflowGroups.push(workflowGroup);
						//alert("neue array length=" + liste.length);

					});

					// json request finished 
					//alert(vWorkflowGroups);
					// store the workflow groups.....
					localStorage.setItem("com.imixs.workflowgroups",
							vWorkflowGroups);
					writeWorkflowGroups();

				});

			} else {
				//alert("liste from cache=" + vWorkflowGroups);
				writeWorkflowGroups();
			}
		}
		
		
		// this method writes the html code for the workflow group list.. 
		function writeWorkflowGroups() {
			//alert('ich bin in der methode');
			vWorkflowGroups = localStorage.getItem("com.imixs.workflowgroups");
			//alert("liste =" + vWorkflowGroups);
			// create a array...
			var groups = vWorkflowGroups.split(",");
			for ( var j = 0; j < groups.length; j++) {
				// create link 
				//alert(groups[j]);
				var link = "worklist.html?id=" + groups[j];
				// add entry to projectlist
				//$("<li/>").html("" + workflowSummary).appendTo("#projects_id");

				$("#projects_id").append(
						"<li><a href=\"" + link + "\">" + groups[j]
								+ "</a></li>");

			}
			// refresh view
			$("#projects_id").listview("refresh");
		}
	</script>

</body>
</html>