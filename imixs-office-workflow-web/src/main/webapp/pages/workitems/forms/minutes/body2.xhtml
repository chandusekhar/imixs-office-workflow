<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">



	<!--  Init script -->
	<script type="text/javascript">
		/*<![CDATA[*/

		// method to refresh create buttons 
		function layoutBodySection(e) {
			if (e.status == 'success') {
				$(".minutes-body-section").imixsLayout();

				/* Imixs Tooltip support */
				$(".minutes-body-section span.imixs-tooltip").prev().tooltip({
					position : {
						my : "left top",
						at : "left+10 bottom",
						collision : "flipfit"
					},
					show : {
						duration : 800
					},
					content : function() {
						var tooltip = $(this).next();
						tooltip.hide();
						return tooltip.text();
					}
				});
				// hide all imixs tooltips 
				$(".minutes-body-section span.imixs-tooltip").hide();

				// layout tinymce for minutes
				tinymce
						.init({
							selector : 'textarea.imixs-minute-editor',
							height : 200,
							menubar : false,
							statusbar : true,
							plugins : [ 'advlist autolink lists link image',
									'searchreplace', 'contextmenu paste' ],
							toolbar : 'undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image',
							content_css : "#{facesContext.externalContext.requestContextPath}/layout/css/tinymce.css"

						});

			}
		}

		/* This method removes the tiny mce editor befor closed. 
		   This call is important to rerender new editor in minute body */
		function closeMinuteEditor() {
			if (tinyMCE) {
				tinymce.remove("textarea.imixs-minute-editor");
			}
		}

		/* This method saves the tinyMCE content. 
			This can not by handled automatically by ajax call */
		function saveTinyMCE() {
			if (tinyMCE) {
				tinyMCE.triggerSave();
				closeMinuteEditor();
			}
		}

		/*]]>*/
	</script>

	<!-- compute edit/read mode -->
	<ui:param name="editmode"
		value="#{(workitem.item['$processid'] lt 1500)?'true':'false'}" />

	<!-- minutes body -->
	<h:panelGroup layout="block"
		styleClass="imixs-form-section minutes-body-section" id="minutes_body"
		binding="#{minutesBody}">

mode=#{editmode}
		<h:panelGroup id="minute_list">
			<!-- minute list  -->
			<ui:repeat var="child" value="#{minuteController.workitems}">
				<ui:include
					src="/pages/workitems/forms/minutes/body_entry.xhtml">
					<ui:param name="editmode" value="#{editmode}" />
					<ui:param name="workitem" value="#{child}" />
					<ui:param name="minutesBody" value="#{minutesBody}" />

				</ui:include>
			</ui:repeat>
		</h:panelGroup>

		

	</h:panelGroup>

</ui:composition>

