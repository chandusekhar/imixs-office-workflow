<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:i="http://java.sun.com/jsf/composite/imixs">

	<!-- **** General info ***** -->
	<div class="row">
		<div class="col-6">

			<h:panelGroup layout="block" id="dmslist"
				binding="#{dmsListComponent}" style="margin-bottom:10px;">

				<!-- **** DMS List ***** -->
				<ui:repeat var="attachment" value="#{dmsController.dmsList}">
					<!-- image -->
					<div style="float: left; height: 34px; margin: 0 2px 2px 0;">
						<h:graphicImage url="/layout/icons/icon048.png"
							rendered="#{!attachment.item['txtName'].contains('://')}"
							style="border:0px;vertical-align: text-top;margin-right:0.5em" />

						<h:graphicImage url="/layout/icons/icon001.png"
							rendered="#{attachment.item['txtName'].contains('://')}"
							style="border:0px;vertical-align: text-top;margin-right:0.5em" />
					</div>
					<!-- link -->
					<div
						style="border-bottom: 1px solid silver; margin: 0 0 10px 20px; padding: 0 0 5px 0;">

						<!-- Attachment link -->
						<h:panelGroup
							rendered="#{!attachment.item['txtName'].contains('://')}">
							<h:outputText escape="false" value="&lt;a target='_blank'" />
							<h:outputText escape="false"
								value=" href='#{facesContext.externalContext.requestContextPath}/rest-service/workflow/workitem/#{attachment.item['$uniqueIDRef']}/file/#{attachment.item['txtName']}" />
							<h:outputText escape="false"
								value="'&gt;#{attachment.item['txtName']}&lt;/a&gt;" />
						</h:panelGroup>
						<!-- URL link -->
						<h:panelGroup
							rendered="#{attachment.item['txtName'].contains('://')}">
							<h:outputText escape="false" value="&lt;a target='_blank'" />
							<h:outputText escape="false"
								value=" href='#{attachment.item['txtName']}" />
							<h:outputText escape="false"
								value="'&gt;#{attachment.item['txtName']}&lt;/a&gt;" />
						</h:panelGroup>

						<br />
						<!-- created by -->
						<h:outputText value="#{attachment.item['$created']}">
							<f:convertDateTime timeZone="#{message.timeZone}"
								pattern="#{message.dateTimePattern}" />
						</h:outputText>
						<h:outputText
							value=" - #{userController.getUserName(attachment.item['namCreator'])}" />
						<br />

						<!-- comment function (toggle feature) -->
						<a onclick="$(this).next().toggle();"
							class="imixs-action-dms-comment" style="cursor: pointer;">[#{message.comment}]</a>
						<div class="dms-comment-panel" style="margin: 4px;">
							<h:inputTextarea value="#{attachment.item['txtComment']}"
								style="width: 100%; height: 50px;" />
						</div>

						<!-- Delete function -->
						<f:ajax render=":#{dmsListComponent.clientId}"
							onevent="hideComments">
							<h:commandLink styleClass="imixs-action-dms-remove"
								actionListener="#{dmsController.removeFile(attachment.item['txtName'])}"
								immediate="true">
								<h:outputText value="[#{message.remove}]" />
							</h:commandLink>
						</f:ajax>
					</div>

				</ui:repeat>
			</h:panelGroup>


		</div>
		<div class="col-6" id="">
			<div class="imixsLinkWidget">
				<f:ajax render=":#{dmsListComponent.clientId} link_input"
					onevent="hideComments">
					<h:commandLink styleClass="imixsLink_button"
						value="#{message['form.attachments.addlink']}"
						actionListener="#{dmsController.addLink}" />
					<h:inputText value="#{dmsController.link}" style="width:180px;"
						id="link_input" />
				</f:ajax>
			</div>
			<i:imixsFileUpload id="file_upload_id"
				workitem="#{workflowController.workitem}"
				context_url="#{facesContext.externalContext.requestContextPath}/rest-service/workflow/workitem/#{workflowController.workitem.item['$uniqueid']}"
				hideatachments="true" />
		</div>
	</div>


	<script type="text/javascript">
		/*<![CDATA[*/

		$(document).ready(function() {
			// init...
			hideComments(null);
			$('.imixsLink_button').button({
				icons : {
					primary : "ui-icon-extlink"
				}
			});
		});

		function hideComments(event) {
			$('.dms-comment-panel').hide();
		}

		/*]]>*/
	</script>

</ui:composition>

